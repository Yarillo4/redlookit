(()=>{"use strict";var t=function(t,e,n,a){return new(n||(n=Promise))((function(o,s){function i(t){try{r(a.next(t))}catch(t){s(t)}}function d(t){try{r(a.throw(t))}catch(t){s(t)}}function r(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,d)}r((a=a.apply(t,e||[])).next())}))};class e{constructor(t,e){this.finishTimeMS=0,this.id=-1;const n=(new Date).getTime();this.finishTimeMS=n+e,this.id=setTimeout(t,e)}getRemainingTime(){return this.finishTimeMS-(new Date).getTime()}cancel(){clearTimeout(this.id)}}var n=function(t,e,n,a){return new(n||(n=Promise))((function(o,s){function i(t){try{r(a.next(t))}catch(t){s(t)}}function d(t){try{r(a.throw(t))}catch(t){s(t)}}function r(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,d)}r((a=a.apply(t,e||[])).next())}))};class a{constructor(){this.i=0,this.salt=0}randomUUID(t){return n(this,void 0,void 0,(function*(){void 0===t&&(t=[{n:8,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:12,charset:"alphanumerical"}]);let e="";for(let n=0;n<t.length;n++){const o=t[n].n,s=a.alphabets[t[n].charset];for(let t=0;t<o;t++){let t=yield this.random(0,s.length-1);e+=s.charAt(Math.round(t))}e+="-"}return Promise.resolve(e.slice(0,-1))}))}setSeed(t){return n(this,void 0,void 0,(function*(){const e=(new TextEncoder).encode(t),n=yield crypto.subtle.digest("SHA-1",e);return this.hash=Array.from(new Uint8Array(n)),this.seed=t,this.i=0,this.salt=0,Promise.resolve()}))}random(t=0,e=1){return n(this,void 0,void 0,(function*(){return void 0===this.hash?Promise.reject(new Error("Seed is blank. Have you called setSeed() before random()?")):e-t>255?Promise.reject(new Error("This random number generator cannot comfortably produce numbers for ranges greater than 8 bits of entropy (ranges containing >256 numbers)")):(this.i>=this.hash.length&&(this.i=0,this.salt++,yield this.setSeed(this.seed+this.salt.toString())),Promise.resolve((this.hash[this.i++]-0)*(e-(n=t))/255+n));var n}))}}a.alphabets={alphanumerical:"abcdefghijklmnopqrstuvwxyz0123456789",alpha:"abcdefghijklmnopqrstuvwxyz"};var o=function(t,e,n,a){return new(n||(n=Promise))((function(o,s){function i(t){try{r(a.next(t))}catch(t){s(t)}}function d(t){try{r(a.throw(t))}catch(t){s(t)}}function r(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,d)}r((a=a.apply(t,e||[])).next())}))};function s(){const t=new URL(document.URL);return"file:"===t.protocol||"localhost"===t.host||"127.0.0.1"===t.host}function i(t,e="Assertion failed"){if(!t&&s())throw new Error(e)}function d(t){const e=document.querySelector(t);return i(null!==e,`Failed to find a DOM element matching selector "${t}"`),e}const r="https://www.reddit.com",l=d("#posts"),c=d("section.reddit-post");let u=["#c24332","#2e303f","#63948c","#ebe6d1","#517c63","#4c525f","#371d31","#f95950","#023246","#2e77ae","#0d2137","#ff8e2b"],h=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];const m=d(".menu"),p=d(".menu-selector");m.addEventListener("click",(()=>{p.classList.toggle("hidden")}));const f=new class{constructor(t=0){this.faces=[],this.promises=[],this.lastTask=null,this.currentID=0,this.throttleMS=1e3;for(let e=0;e<t;e++)this.sideload()}getFaces(){return this.faces}all(){return t(this,void 0,void 0,(function*(){return Promise.all(this.promises)}))}sideload(){return t(this,void 0,void 0,(function*(){let t=0;if(null!==this.lastTask){const e=Math.max(0,this.lastTask.getRemainingTime());t=e+this.throttleMS,t<0&&(t=0)}const n=new Promise(((n,a)=>{const o=this.currentID;this.lastTask=new e((()=>{let t=document.createElement("img");t.src=`https://thispersondoesnotexist.com/image?cnh=${o}`,t.addEventListener("load",(()=>{this.faces.push(t),n(t)}),{once:!0,passive:!0}),t.addEventListener("error",(()=>{a()}),{once:!0,passive:!0})}),t)}));return this.currentID++,this.promises.push(n),n}))}}(200),v=new a;function g(t){if(s()&&console.log("interpreting link",t),null===t)L("popular"),s()&&y("/r/test/comments/z0yiof/formatting_test/");else{const e=function(t){const e=t.match(/\/?r\/([^/]+?)\/comments\/([^/]+)/);if(s()&&console.log("postMatch",e),null!==e)return L(e[1]),S(),y(t),!0;{const e=t.match(/\/?r\/([^/]+)/);return s()&&console.log("subMatch",e),null!==e&&(L(e[1]),!0)}}(t);!1===e&&L("popular")}}function L(t){!function(){const t=document.querySelector("#posts");null!==t&&(t.innerHTML="")}(),document.createElement("section").classList.add("post"),axios.get(`${r}/r/${t}.json?limit=75`).then((function(t){!function(t){for(let e of t){let t=document.createElement("button");t.classList.add("post");let n=document.createElement("span"),a=e.data.title;n.append(a),t.title=e.data.title,n.classList.add("title");let o=document.createElement("span");o.append(e.data.subreddit_name_prefixed),o.classList.add("subreddit");let s=document.createElement("span");s.innerHTML='<svg width="18" height="18" style="margin-right: 5px;" viewBox="0 0 94 97" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M88.1395 48.8394C84.9395 46.0394 60.4728 18.0061 48.6395 4.33939C46.6395 3.53939 45.1395 4.33939 44.6395 4.83939L4.63948 49.3394C2.1394 53.3394 7.63948 52.8394 9.63948 52.8394H29.1395V88.8394C29.1395 92.0394 32.1395 93.1727 33.6395 93.3394H58.1395C63.3395 93.3394 64.3062 90.3394 64.1395 88.8394V52.3394H87.1395C88.8061 52.0061 91.3395 51.6394 88.1395 48.8394Z" stroke="#818384" stroke-width="7"/></svg>',s.append(`${e.data.score.toLocaleString()}`),s.innerHTML+='<svg width="18" height="18" style="transform: rotate(180deg); margin-left: 5px" viewBox="0 0 94 97" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M88.1395 48.8394C84.9395 46.0394 60.4728 18.0061 48.6395 4.33939C46.6395 3.53939 45.1395 4.33939 44.6395 4.83939L4.63948 49.3394C2.1394 53.3394 7.63948 52.8394 9.63948 52.8394H29.1395V88.8394C29.1395 92.0394 32.1395 93.1727 33.6395 93.3394H58.1395C63.3395 93.3394 64.3062 90.3394 64.1395 88.8394V52.3394H87.1395C88.8061 52.0061 91.3395 51.6394 88.1395 48.8394Z" stroke="#818384" stroke-width="7"/></svg>',s.classList.add("post-data");let i=document.createElement("span");i.classList.add("profile");let d=h[Math.floor(Math.random()*h.length)]+h[Math.floor(Math.random()*h.length)],r=u[Math.floor(Math.random()*u.length)];"#ebe6d1"!==r&&"#ebe6d1"!==r||(i.style.color="black"),i.style.backgroundColor=r,i.append(d),t.append(i,n,o,s),t.addEventListener("click",(()=>{var n;null===(n=document.querySelector(".focused-post"))||void 0===n||n.classList.remove("focused-post"),t.classList.add("focused-post"),x(e.data.permalink),y(e.data.permalink)})),l.append(t)}l.append("That's enough reddit for now. Get back to work!")}(t.data.data.children)})).catch((t=>{console.error(t)}))}function y(t){const e=`${b(new URL(`${r}${t}`))}/.json?limit=75`;return axios.get(e).then((t=>{try{S(),function(t){var e,n,a,o,s;try{d(".reddit-post").scrollTop=0}catch(t){console.error(t)}const i=t.data[1].data.children,l=document.createElement("span");l.append(`Posted by u/${t.data[0].data.children[0].data.author}`),l.classList.add("post-author"),c.append(l);const u=document.createElement("h4"),h=document.createElement("a");u.appendChild(h);const m=t.data[0].data.children[0].data.title;if(h.href=`${r}${t.data[0].data.children[0].data.permalink}`,h.append(m),u.classList.add("post-section-title"),c.append(u),"image"===t.data[0].data.children[0].data.post_hint){let e=document.createElement("img");e.src=t.data[0].data.children[0].data.url_overridden_by_dest,e.classList.add("post-image"),c.append(e)}if(""!==t.data[0].data.children[0].data.selftext&&!t.data[0].data.children[0].data.selftext.includes("preview")){const e=document.createElement("div");e.innerHTML=M(t.data[0].data.children[0].data.selftext_html),e.classList.add("usertext"),c.append(e)}if(!1===t.data[0].data.children[0].data.is_self&&!1===t.data[0].data.children[0].data.is_reddit_media_domain){const e=document.createElement("div"),n=document.createElement("img"),a=document.createElement("a");n.src=t.data[0].data.children[0].data.thumbnail,a.href=t.data[0].data.children[0].data.url_overridden_by_dest,a.innerText=m,a.target="_blank",a.classList.add("post-link"),e.append(n),e.append(a),e.classList.add("post-link-container"),c.append(e)}const p=null===(s=null===(o=null===(a=null===(n=null===(e=null==t?void 0:t.data[0])||void 0===e?void 0:e.data)||void 0===n?void 0:n.children[0])||void 0===a?void 0:a.data)||void 0===o?void 0:o.secure_media)||void 0===s?void 0:s.reddit_video;if(void 0!==p&&"null"!==p){const e=document.createElement("video");e.classList.add("post-video"),e.setAttribute("controls","");const n=document.createElement("source");n.src=t.data[0].data.children[0].data.secure_media.reddit_video.fallback_url,e.appendChild(n),c.append(e)}const v=function(t){let e=document.createElement("span");e.innerHTML='<svg width="18px" height="18px" style="margin-right: 5px;" viewBox="0 0 94 97" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M88.1395 48.8394C84.9395 46.0394 60.4728 18.0061 48.6395 4.33939C46.6395 3.53939 45.1395 4.33939 44.6395 4.83939L4.63948 49.3394C2.1394 53.3394 7.63948 52.8394 9.63948 52.8394H29.1395V88.8394C29.1395 92.0394 32.1395 93.1727 33.6395 93.3394H58.1395C63.3395 93.3394 64.3062 90.3394 64.1395 88.8394V52.3394H87.1395C88.8061 52.0061 91.3395 51.6394 88.1395 48.8394Z" stroke="#818384" stroke-width="7"/></svg>',e.append(`${t.data[0].data.children[0].data.ups.toLocaleString()}`),e.innerHTML+='<svg width="18px" height="18px" style="transform: rotate(180deg); margin-left: 5px" viewBox="0 0 94 97" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M88.1395 48.8394C84.9395 46.0394 60.4728 18.0061 48.6395 4.33939C46.6395 3.53939 45.1395 4.33939 44.6395 4.83939L4.63948 49.3394C2.1394 53.3394 7.63948 52.8394 9.63948 52.8394H29.1395V88.8394C29.1395 92.0394 32.1395 93.1727 33.6395 93.3394H58.1395C63.3395 93.3394 64.3062 90.3394 64.1395 88.8394V52.3394H87.1395C88.8061 52.0061 91.3395 51.6394 88.1395 48.8394Z" stroke="#818384" stroke-width="7"/></svg>',e.classList.add("post-detail-info");let n=document.createElement("span");n.classList.add("post-detail-info"),n.append(t.data[0].data.children[0].data.subreddit_name_prefixed);let a=document.createElement("span");return a.append(`${t.data[0].data.children[0].data.num_comments.toLocaleString()} Comments`),a.classList.add("post-detail-info"),[e,n,a]}(t);c.append(...v),c.append(document.createElement("hr")),function(t){c.classList.add("post-selected"),c.classList.remove("deselected");const e=f.getFaces().slice(0);E(c,t,{indent:0,ppBuffer:e})}(i)}(t)}catch(t){console.error(t)}})).catch((t=>{console.error(t)}))}function w(){const t=new URL(document.URL).hash;return""===t?null:t.slice(1)}function b(t){return"/"===t.pathname.substr(-1)?(t.pathname=t.pathname.slice(0,-1),t):t}function x(t,e=!0){const n=b(new URL(document.URL)),a=new URL(`${n.protocol}//${n.hostname}${n.pathname}#${t}`);window.history.pushState({},"",a)}function E(t,e,n={indent:0,ppBuffer:[]}){for(const a of e)if("t1"===a.kind){const e=document.createElement("div");n.indent>0&&e.classList.add("replied-comment"),t.appendChild(e);const o=a;C(o,{ppBuffer:n.ppBuffer,domNode:e}),o.data.replies&&E(e,o.data.replies.data.children,{indent:n.indent+10,ppBuffer:n.ppBuffer}),0===n.indent&&t.appendChild(document.createElement("hr"))}}function k(t,e=50,n=[]){return o(this,void 0,void 0,(function*(){const a=yield function(){return o(this,void 0,void 0,(function*(){if("gnometalk"===t.data.subreddit)return function(t){return o(this,void 0,void 0,(function*(){const t=document.createElement("img");t.classList.add("gnome");const e=(yield v.random())<=.5?"scaleX(-1) ":"",n=yield v.random(),a=`${e}rotate(${Math.round(40*n-20)}deg) `;t.style.transform=a;const o=yield v.random();return t.style.backgroundColor=u[Math.floor(o*u.length)],t}))}();{const t=(()=>{if(n.length<10)return 0;{const t=.7;return n.length>=25?t:(n.length-10)/15*t}})();return(yield v.random())<t?function(t,e,n=50){return o(this,void 0,void 0,(function*(){const t=Math.round(yield v.random(0,e.length-1)),a=e[t],o=function(t,e){const n=document.createElement("canvas");n.height=n.width=2*e,n.style.height=n.style.width=e.toString();const a=n.getContext("2d");if(null!==a){a.imageSmoothingEnabled=!1,a.imageSmoothingQuality="high";try{a.drawImage(t,0,0,2*e,2*e)}catch(e){console.error(t,e)}return n}return null}(a,n);return i(null!==o,`generateFacePic couldn't get a canvas 2D context from image #${t}, ${a.src} (img.${Array.from(a.classList).join(".")})`),o.classList.add(`human-${t}`),o}))}(0,n):function(t,e){return o(this,void 0,void 0,(function*(){const t=document.createElement("span"),n=yield v.random(0,h.length-1),a=yield v.random(0,h.length-1),o=h[Math.round(n)]+h[Math.round(a)];t.style.padding=`${Math.round(.12*e)}px 3px 3px 3px`,t.style.fontSize=`${Math.round(e/2.08)}px`,t.style.fontWeight="bold",t.style.textAlign="center",t.style.display="inline-block",t.style.cssText+="-webkit-touch-callout: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;";const s=yield v.random(0,u.length-1);return t.style.backgroundColor=u[Math.round(s)],t.textContent=`${o}`,t}))}(0,e)}}))}();return a.classList.add("avatar"),a.style.marginRight="10px",a.classList.contains("avatar-circle")||a.classList.add("avatar-circle"),a}))}function C(t,e={ppBuffer:[]}){return o(this,void 0,void 0,(function*(){void 0===e.domNode&&(e.domNode=document.createElement("div")),e.domNode.id=t.data.id,e.domNode.classList.add("usertext"),e.domNode.classList.add("comment");const n=document.createElement("div");n.classList.add("author"),n.style.display="flex",yield v.setSeed(t.data.author);const a=document.createElement("span");a.style.width=a.style.height="50px",n.appendChild(a),k(t,50,e.ppBuffer).then((t=>{n.replaceChild(t,a)}));let o=document.createElement("div");o.classList.add("author-text"),o.style.display="flex",o.style.flexDirection="column";{let e=document.createElement("span");e.classList.add("username"),e.classList.add("email");const n=(""+t.data.score).length,a=[{n:8,charset:"alpha"},{n:4,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:4,charset:"alphanumerical"},{n:12,charset:"alphanumerical"}];v.randomUUID(a).then((a=>{const o=a.slice(n);e.innerHTML=`${t.data.author} <${t.data.score}${o}@securemail.org>`})),o.append(e);let s=new Date(1e3*t.data.created_utc);const i=document.createElement("span");i.classList.add("comment-posted-date"),i.innerHTML=s.toString().slice(0,21),i.style.color="#a2a2a2",i.style.fontSize="0.85em",o.append(i)}n.append(o);const s=document.createElement("div");return s.insertAdjacentHTML("beforeend",M(t.data.body_html)),e.domNode.prepend(n,s),e.domNode}))}function M(t){var e=document.createElement("textarea");return e.innerHTML=t,e.value}function S(){c.innerHTML=""}const T=d("form"),$=d("input"),H=d(".your-subreddits");T.addEventListener("submit",(t=>o(void 0,void 0,void 0,(function*(){t.preventDefault();let e=document.createElement("button");e.classList.add("subreddit","button"),e.id=$.value,e.addEventListener("click",(t=>o(void 0,void 0,void 0,(function*(){S(),s()&&console.log("custom sub click",e.id),x(`/r/${e.id}`),L(e.id)})))),e.append("r/"+$.value),H.append(e),$.value=""}))));const _=document.querySelectorAll(".popular-subreddits>button");for(let t of _)t.addEventListener("click",(e=>o(void 0,void 0,void 0,(function*(){s()&&console.log("default sub click",t.id),x(`/r/${t.id}`),S(),L(t.id)}))));let D=!1;function B(t){return"object"==typeof t&&void 0!==t.style}d(".mark-as-read-btn").addEventListener("click",(()=>{D||(alert("This button literally does nothing"),D=!0)})),d(".inbox-button").addEventListener("click",(()=>o(void 0,void 0,void 0,(function*(){s()&&console.log("inbox click","/r/popular"),x("/r/popular"),S(),L("popular")}))));let R=document.querySelectorAll(".collapsible");for(let t of R)t.addEventListener("click",(function(){var t;let e=null==this?void 0:this.nextElementSibling;if(!B(e))return;let n=null===(t=null==this?void 0:this.firstChild)||void 0===t?void 0:t.nextSibling;B(n)&&("none"===e.style.display?(n.classList.remove("ms-Icon--ChevronRight"),n.classList.add("ms-Icon--ChevronDownMed"),e.style.display="block"):(n.classList.remove("ms-Icon--ChevronDownMed"),n.classList.add("ms-Icon--ChevronRight"),e.style.display="none"))}));const U=d(".post-sidebar");let I;function P(t){const e=I-t.x;I=t.x,U.style.width=`${parseInt(getComputedStyle(U,"").width)+e}px`}U.addEventListener("mousedown",(function(t){t.offsetX<4&&(I=t.x,document.addEventListener("mousemove",P,!1))}),!1),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",P,!1)}),!1);let A=d(".settings-button"),j=d(".settings-panel");A.addEventListener("click",(()=>{q.classList.remove("profile-panel-show"),j.classList.toggle("settings-panel-show")})),d(".close-settings").addEventListener("click",(()=>{j.classList.remove("settings-panel-show")}));const N=d("#flexSwitchCheckChecked");N.addEventListener("change",(function(){const t=d("body");N.checked?(t.classList.remove("light"),t.classList.add("dark")):(t.classList.remove("dark"),t.classList.add("light"))})),window.addEventListener("hashchange",(()=>{S();const t=w();s()&&console.log("history buttons clicked",t),g(t)}));let V=d(".profile-button"),q=d(".profile-panel");if(V.addEventListener("click",(()=>{j.classList.remove("settings-panel-show"),q.classList.toggle("profile-panel-show")})),s()){const t=document.getElementById("loadingScreen");t&&(t.style.display="none")}g(w())})();